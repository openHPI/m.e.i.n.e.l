<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="plotly-import.html">


<!--
`linechart-basic`
This is a basic component for plotly linecharts

@demo demo/linechart_basic_demo.html
-->
<dom-module id="linechart-basic">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <iron-ajax
        id="ajaxCaller"
        url="[[dataurl]]"
        handle-as="json"
        on-response="handleResponse"
        debounce-duration="300">
    </iron-ajax>
    <div style="display:none;">{{data}}</div>
    <div id="myDiv"></div>
  </template>

  <script>
    Polymer({
      is: 'linechart-basic',

      properties: {
        /** URL of data to be plotted */
        dataurl: {
          type: String,
          value: "",
        },
        /** Data provided as an array of x,y objects */
        data: {
          type: String,
        },
        /** Width of the outer div */
        width: {
          type: Number,
        },
        /** Height of the out div */
        height: {
          type: Number,
        },
      },
      attached: function() {
        if(this.dataurl != "") {
          this.$.ajaxCaller.generateRequest();
        }
        else {
          this._plotDiagram();
        }
      },

      _plotDiagram: function () {
        var rawData = JSON.parse(this.data);

        var d3 = Plotly.d3;

        var WIDTH_IN_PERCENT_OF_PARENT = 100,
            HEIGHT_IN_PERCENT_OF_PARENT = 100;

        /** Defines the width and height of the outer div */
        if (this.width !== undefined && this.height !== undefined) {
          var myDiv = d3.select(this.$.myDiv);

          myDiv.style('width', this.width + "px");
          myDiv.style('height', this.height + "px");
        }

        /** Create new div with specific attributes under outer div */
        var gd3 = d3.select(this.$.myDiv)
            .append('div')
            .style({
                width: WIDTH_IN_PERCENT_OF_PARENT + '%',
                'margin-left': (100 - WIDTH_IN_PERCENT_OF_PARENT) / 2 + '%',

                height: HEIGHT_IN_PERCENT_OF_PARENT + '%',
                'margin-top': (100 - HEIGHT_IN_PERCENT_OF_PARENT) / 2 + '%'
            });

        var gd = gd3.node();
        var layout = {
          xaxis: {
            tickmode: "auto",
            nticks: 4,
            tickfont: {
              size: 14,
              color: this.accentcolor,
            },
          },
          yaxis: {
            tickfont: {
              size: 14,
              color: this.accentcolor,
            },
          },
        };
        Plotly.newPlot(gd, rawData, layout);
        window.addEventListener('resize', function() { Plotly.Plots.resize(gd); });
      },

    });
  </script>
</dom-module>
