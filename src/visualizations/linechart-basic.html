<link rel="import" href="../../../polymer/polymer-element.html">
<link rel="import" href="../../../polymer/lib/elements/dom-module.html">
<link rel="import" href="../mixins/plotly-mixin.html">
<link rel="import" href="../shared-styles/plotly-styles.html">

<dom-module id="linechart-basic">
    <template>
        <style include="plotly-styles">
            :host {
                display: block;
            }
        </style>
        <div id="diagram"></div>
    </template>

    <script>
        /**
         * ## `linechart-basic`
         *
         * This is a basic component for plotly linecharts.
         *
         * For further information and deeper understanding visit the [Plotly line chart documentation](https://plot.ly/javascript/line-charts/).
         *
         * @polymer
         * @customElement
         * @demo demo/visualizations/linechart_basic_demo.html
         */
        class LinechartBasic extends PlotlyMixin(Polymer.Element) {

            static get is() {
                return 'linechart-basic';
            }

            static get properties() {
                return {
                    /** Accent color of chart */
                    accentcolor: {
                        type: String,
                        value: 'rgba(0,0,0,1)',
                        reflectToAttribute: true
                    },
                    /** Scroll and zoom activation */
                    scrollzoom: {
                        type: Boolean,
                        value: false,
                        reflectToAttribute: true
                    },
                    /** Scroll range provided in % 0 to 100 */
                    scrollrange: {
                        type: Number,
                        value: 100,
                        reflectToAttribute: true
                    },
                    /** Mode of the line chart. Must be either `markers`, `lines` or `lines+markers`. */
                    mode: {
                        type: String,
                        value: 'lines'
                    },
                    /** Determines whether to show the latest value at the end of the graph */
                    highlightLatest: {
                        type: Boolean,
                        value: false
                    },
                    /** Draw vertical dotted lines at specified x-axis points */
                    vLines: {
                        type: Array,
                        value: []
                    }
                };
            }

            static get observers() {
                return [];
            }

            /** Gets the container element of the diagram that should be rendered */
            getDiagram() {
                return this.$.diagram;
            }

            /** Gets the data of the plot */
            getPlotData(data) {
                let that = this;
                data.forEach((series) => {
                    series.mode = series.mode || that.mode;
                    if (that.highlightLatest) {
                        series.mode = series.mode + '+text';
                        series.textposition = 'middle right';
                        series.textfont = {size: 16};
                        series.text = series.y.map((value, i) => i == series.y.length - 1 ? value : '');
                    }
        });

                return data;
            }

            /** Gets the layout options of the plot */
            getLayout() {
                let layout = {
                    xaxis: {
                        tickmode: 'auto',
                        tickfont: {
                            size: 14,
                            color: this.accentcolor
                        }
                    },
                    yaxis: {
                        fixedrange: true,
                        tickfont: {
                            size: 14,
                            color: this.accentcolor
                        }
                    },
                    margin: {l: 40, r: 10, t: 10, b: 40},
                    shapes: []
                };

                if (this.scrollzoom) {
                    let maxX = data[0].x[data[0].x.length - 1];
                    let minX = data[0].x[Math.round(data[0].x.length * (1 - this.scrollrange / 100))];
                    layout.xaxis.rangeslider = {};
                    layout.xaxis.range = [minX, maxX];
                }

                this.vLines.forEach((item, index) => {
                    layout.shapes.push(
                        {
                            type: 'line',
                            x0: item,
                            y0: 0,
                            x1: item,
                            yref: 'paper',
                            y1: 1,
                            line: {
                                color: 'grey',
                                width: 1.5,
                                dash: 'dot'
                            }
                        }
            );
        });

                return layout;
            }

            /** Gets the config options of the plot */
            getConfig() {
                if (!this.scrollzoom) {
                    return {};
                }

                return {scrollZoom: true};
            }
        }

        // Register custom element definition using standard platform API
        customElements.define(LinechartBasic.is, LinechartBasic);
    </script>
</dom-module>
