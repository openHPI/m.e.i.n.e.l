<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-ajax/iron-ajax.html">
<link rel="import" href="../../count-up/count-up.html">
<link rel="import" href="font-awesome-import.html">


<!--
`score-card`
<br />This is a basic component for a score card displaying a single numeric value.

@demo demo/score_card_demo.html
-->
<dom-module id="score-card">
    <template>
      <style>
        :host {
          display: block;
        }

        #container {
          display: flex;
          width: 100%;
        }

        #icon-container {
          display: flex;
          flex-grow: 0;
          flex-shrink: 0;
          align-items: center;
          justify-content: center;
          min-width: 50px;
          min-height: 50px;
          border-radius: 2px 0px 0px 2px;
        }

        #icon {
          width: 50%;
          height: 50%;
        }
        #icon > svg {
          width: 100%;
          height: 100%;
        }

        #content-container {
          position: relative;
          padding: 5px 10px;
        }

        #name {
          display: block;
          font-size: 14px;
          overflow: hidden;
          text-overflow: ellipsis;
          margin-bottom: 3px;
        }

        #number, #spinner {
          display: block;
          font-weight: bold;
          font-size: 18px;
        }

        #link-container {
          position: absolute;
          bottom: 5px;
          font-size: 14px;
        }
      </style>

      <div id="container">
        <div id="icon-container" style$="background-color: [[primarycolor]]; height: [[height]]px; flex-basis: [[height]]px;">
          <i id="icon" class$="[[_faIconStyle]] fa-[[icon]]"></i>
        </div>
        <div id="content-container">
          <span id="name">[[name]]</span>
          <template is="dom-if" if="[[_hasValue]]">
            <count-up id="number" update-to="[[data]]" decimals="[[decimals]]" duration="[[animationDuration]]"></count-up>
          </template>
          <div id="spinner-container">
            <template is="dom-if" if="[[!_hasValue]]">
              <i id="spinner" class="fas fa-spinner fa-spin"></i>
            </template>
          </div>
          <div id="link-container">
            <template is="dom-if" if="[[link]]">
              <a href="[[link]]">
                [[linkText]] <i class="fas fa-arrow-circle-right"></i>
              </a>
            </template>
          </div>
        </div>
      </div>
    </template>

    <script>
        window.addEventListener("WebComponentsReady", function() {
            Polymer({
                is: 'score-card',
                properties: {
                    /** Datavalue to be displayed. */
                    data: {
                        type: Number,
                        value: null,
                    },
                    /** Height of the control. */
                    height: {
                        type: Number,
                        value: 100,
                    },
                    /** Primary color of the control. */
                    primarycolor: String,
                    /** Name of the FontAwesome icon that is displayed. */
                    icon: String,
                    /** Style of the FontAwesome icon that is displayed. Can be `regular` or `solid`. */
                    iconStyle: {
                      type: String,
                      value: 'solid',
                    },
                    /** Name of the metric that is displayed. */
                    name: String,
                    /** Number of decimals to show. */
                    decimals: {
                      type: Number,
                      value: 0,
                    },
                    /** Animation duration in seconds. */
                    animationDuration: {
                      type: Number,
                      value: 1,
                    },
                    /** A link to a page showing related information (optional). */
                    link: String,
                    /** The text of the link (optional). */
                    linkText: String,
                    _hasValue: {
                      type: Boolean,
                      computed: '_computeHasValue(data)',
                    },
                    _faIconStyle: {
                      type: String,
                      computed: '_computeFaIconStyle(iconStyle)',
                    },
                },
                /** This is called by Polymer after property values are set and local DOM is initialized. */
                ready: function() {
                  // Enable mutation observer on icon that apply Polymer CSS scoping
                  // on nested SVG element inserted into the DOM by FontAwesome.
                  this.scopeSubtree(this.$['icon'], true);
                },
                /** Computes the value of the '_hasValue' property. */
                _computeHasValue: function(data) {
                  return typeof data === 'number';
                },
                /** Computes the value of the '_faIconStyle' property. */
                _computeFaIconStyle: function(iconStyle) {
                  return iconStyle === 'solid' ? 'fas' : 'far';
                },
            });
        });
    </script>
</dom-module>
