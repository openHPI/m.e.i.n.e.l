<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="plotly-import.html">


<!--
`piechart-basic`
This is a basic component for plotly piecharts

@demo demo/piechart_basic_demo.html
-->
<dom-module id="piechart-basic">
    <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <div style="display:none;">{{data}}</div>
    <div id="diagram"></div>
  </template>

    <script>
        window.addEventListener("WebComponentsReady", function() {
            Polymer({
                is: 'piechart-basic',

                properties: {
                    /** Datavalues to be plotted */
                    data: {
                        type: Array,
                    },
                    /** Labels for the dataset (must be same size as dataset)*/
                    labels: {
                        type: Array,
                    },
                    /** Width of the outer div */
                    width: {
                        type: Number,
                    },
                    /** Height of the outer div */
                    height: {
                        type: Number,
                    },
                    /** Colors for the dataset (must be same size as dataset)*/
                    colors: {
                        type: Array,
                    },
                },
                attached: function() {
                    this._plotDiagram();
                },
                /**
                 * Displays the data in a pie chart
                 *
                 * @param {Array<number>} dataset The data to be plotted
                 * @param {Array<string>} labels The labels corresponding to the dataset
                 * @param {Array<string>} colors The colors the data shall be displayed in
                 */

                _plotDiagram: function() {
                    var d3 = Plotly.d3;

                    var WIDTH_IN_PERCENT_OF_PARENT = 100,
                        HEIGHT_IN_PERCENT_OF_PARENT = 100;

                    /** Defines the width and height of the outer div */
                    if (this.width && this.height) {
                        var diagram = d3.select(this.$.diagram);

                        diagram.style('width', this.width + "px");
                        diagram.style('height', this.height + "px");
                    }

                    /** Create new div with specific attributes under outer div */
                    var gd3 = d3.select(this.$.diagram)
                        .append('div')
                        .style({
                            width: WIDTH_IN_PERCENT_OF_PARENT + '%',
                            'margin-left': (100 - WIDTH_IN_PERCENT_OF_PARENT) / 2 + '%',

                            height: HEIGHT_IN_PERCENT_OF_PARENT + '%',
                            'margin-top': (100 - HEIGHT_IN_PERCENT_OF_PARENT) / 2 + '%'
                        });

                    var gd = gd3.node();

                    var dataSet = [{
                        values: this.data,
                        labels: this.labels,
                        type: 'pie',
                        marker: {
                            colors: this.colors
                        },
                    }];
                    Plotly.newPlot(gd, dataSet);
                    window.addEventListener('resize', function() {
                        Plotly.Plots.resize(gd);
                    });
                },
                ready: function() {
                    if (this.dataset && this.labels) {
                        this._plotDiagram(this.dataset, this.labels, this.colors);
                    } else {
                        console.error("[ERROR] You did not supply any data.");
                    }
                }
            });
        });
    </script>
</dom-module>
